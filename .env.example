# ============================================================================
# SMAP Speech-to-Text - Environment Configuration Example
# ============================================================================

# ============================================================================
# Application Settings
# ============================================================================
APP_NAME=SMAP Speech-to-Text
APP_VERSION=1.0.0
ENVIRONMENT=development
DEBUG=True

# ============================================================================
# API Service Settings
# ============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_RELOAD=True
API_WORKERS=1
MAX_UPLOAD_SIZE_MB=500

# ============================================================================
# MongoDB Settings (Primary Database)
# ============================================================================
# Base MongoDB URL (without credentials)
MONGODB_URL=mongodb://localhost:27017
MONGODB_DATABASE=stt_system

# MongoDB Authentication
MONGODB_ROOT_USER=
MONGODB_ROOT_PASSWORD=

# MongoDB Connection Pool
MONGODB_MAX_POOL_SIZE=10
MONGODB_MIN_POOL_SIZE=1

# ============================================================================
# RabbitMQ Settings (Message Queue)
# ============================================================================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
RABBITMQ_VHOST=/
RABBITMQ_QUEUE_NAME=stt_jobs_queue
RABBITMQ_EXCHANGE_NAME=stt_exchange
RABBITMQ_ROUTING_KEY=stt.job

# ============================================================================
# MinIO Settings (Object Storage)
# ============================================================================
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=stt-audio-files
MINIO_USE_SSL=False

# ============================================================================
# Storage Settings (Temporary Processing)
# ============================================================================
TEMP_DIR=/tmp/stt_processing

# ============================================================================
# Whisper Settings
# ============================================================================
# Whisper executable path
WHISPER_EXECUTABLE=./whisper/bin/whisper-cli

# Whisper models directory
WHISPER_MODELS_DIR=./whisper/models

# Default Whisper model (tiny, base, small, medium, large)
DEFAULT_WHISPER_MODEL=medium

# ============================================================================
# Whisper Quality/Accuracy Flags (Optimized for Transcription)
# ============================================================================
# Maximum context tokens to store (0 = disable context reuse between chunks)
# Recommended: 0 (prevents repetition between chunks)
WHISPER_MAX_CONTEXT=0

# No-speech threshold (higher = less false positives, only transcribe when certain)
# Range: 0.0-1.0, Default: 0.6, Recommended: 0.7
WHISPER_NO_SPEECH_THOLD=0.7

# Entropy threshold for decoder (higher = less hallucination)
# Range: typically 0.0-5.0, Default: 2.4, Recommended: 2.6
WHISPER_ENTROPY_THOLD=2.6

# Log probability threshold (higher = filter low-quality predictions)
# Range: typically -2.0 to 0.0, Default: -1.0, Recommended: -0.8
WHISPER_LOGPROB_THOLD=-0.8

# Disable temperature fallback (more consistent output)
# Recommended: true (for consistent transcription)
WHISPER_NO_FALLBACK=true

# Suppress specific tokens using regex (optional)
# Example: "\\[.*\\]" to suppress tokens like [music], [noise], [silence]
# Leave empty to disable
WHISPER_SUPPRESS_REGEX=

# ============================================================================
# Chunking Settings
# ============================================================================
# Default chunk duration in seconds (for fixed-duration strategy)
CHUNK_DURATION=30

# Silence detection threshold in dBFS (lower = more sensitive)
# Typical range: -60 to -30, Default: -40
SILENCE_THRESHOLD=-40

# Minimum silence duration in seconds (for silence-based chunking)
MIN_SILENCE_DURATION=1.0

# Filter intro/outro zones (skip first/last N seconds)
# Recommended: true (removes intro music/outro credits)
FILTER_INTRO_OUTRO=true

# Minimum chunk duration in seconds (filter very short chunks)
# Recommended: 2.0 (filters noise bursts)
MIN_CHUNK_DURATION=2.0

# Maximum chunk duration in seconds (split longer chunks)
# Recommended: 60.0 (ensures manageable chunk size)
MAX_CHUNK_DURATION=60.0

# ============================================================================
# Processing Settings
# ============================================================================
# Maximum retry attempts for transcription failures
MAX_RETRIES=3

# Job timeout in seconds (total time for entire job)
JOB_TIMEOUT=3600

# Chunk timeout in seconds (time for single chunk transcription)
CHUNK_TIMEOUT=300

# Maximum concurrent jobs (number of jobs processed in parallel)
MAX_CONCURRENT_JOBS=1

# ============================================================================
# Parallel Processing Settings (Chunk Transcription Optimization)
# ============================================================================
# Number of parallel workers for transcribing chunks (within a single job)
# Recommended: Number of CPU cores (e.g., 4 for quad-core)
# Higher = faster transcription but more CPU/memory usage
MAX_PARALLEL_WORKERS=4

# Enable/disable parallel transcription
# true = transcribe multiple chunks simultaneously (faster)
# false = transcribe chunks sequentially (slower but uses less resources)
USE_PARALLEL_TRANSCRIPTION=true

# ============================================================================
# Logging Settings
# ============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
# Note: LOG_LEVEL takes precedence over DEBUG flag
LOG_LEVEL=INFO

# Log file path
LOG_FILE=logs/stt.log

# ============================================================================
# Scheduler Settings
# ============================================================================
# Scheduler timezone (for periodic tasks)
SCHEDULER_TIMEZONE=Asia/Ho_Chi_Minh
